<script type="text/javascript" src="/js/angular/services/media.js"></script>
<script type="text/javascript">
    angular.module('inlineMedia', ['media', 'ui.sortable'])
    .controller('InlineMediaController', function($scope, $sce, $http, mediaService) {
        $scope.mediaPreview = '';
        $scope.addedMedia = {
            link: ''
        };

        $scope.getMediaPreviewHTML = function() {
            return $sce.trustAsHtml($scope.mediaPreview);
        }

        $scope.showMediaModal = function(isFile) {
            $scope.addedMedia.isFile = isFile;
            $('#media_modal').modal({backdrop: 'static', keyboard: true});
        }

        $scope.loadMediaLink = function() {
            if(!$scope.addedMedia.link.length) {
                return;
            }

            $scope.loadingLink = true;

            mediaService.loadMediaLink($scope.addedMedia.link, function(err, result) {
                if(err) {
                    $scope.loadingLink = false;
                    console.log(err);
                    return;
                }

                console.log(result);

                mediaService.getMediaPreview(result.data.mediaType, result.data.location, function(err, result) {
                    $scope.loadingLink = false;

                    if(err) {
                        console.log(err);
                        return;
                    }

                    console.log(result);
                    $scope.mediaPreview = result.data;
                })
            });
        }
    });
</script>
