<script type="text/javascript" src="/js/angular/services/form_validation.js"></script>
<script type="text/javascript">
    angular.module('pencilblueApp', ['validation'])
    .controller('PencilBlueController', function($scope, $http, $window, validationService) {
        ^angular_objects^
        ^tmp_angular=admin=elements=is_field_valid^

        $scope.addNewSite = function() {
            $scope.formSubmitted = true;

            if(!validationService.isFormValid($scope.siteForm)) {
                return;
            }

            $scope.saving = true;

            $http.post('/actions/admin/site', $scope.siteEntity)
            .success(function(result) {
                $scope.successMessage = result.message;
                $scope.saving = false;
                $scope.onActionSuccess();
                $scope.$apply();
            })
            .error(function(error, status) {
                $scope.errorMessage = error.message;
                $scope.saving = false;
            });
        };

        $scope.activateSite = function(site) {
            $http.post('/actions/admin/site/activate/' + site.uid)
            .success(function(result) {
                $scope.onActionSuccess();
                $scope.$apply();
            })
            .error(function(error, status) {
                $scope.errorMessage = error.message;
            });
        };

        $scope.deactivateSite = function(site) {
            $http.post('/actions/admin/site/deactivate/' + site.uid)
            .success(function(result) {
                $scope.onActionSuccess();
                $scope.$apply();
            })
            .error(function(error, status) {
                $scope.errorMessage = error.message;
            });
        };

        $scope.onActionSuccess = function() {
            $scope.refreshPage();
        }

        $scope.refreshPage = function() {
            $window.location.reload();
        }
    });
</script>
