<script src="/js/admin-new/elements/server_status.js"></script>
<div ng-controller="ServerStatusController">
  <div class="col-md-12">
    <h3>^loc_SERVER^</h3>
    <i class="fa fa-2x fa-circle-o-notch fa-spin" ng-if="!cluster"></i>
  </div>
  <div class="col-lg-3 col-md-4 col-sm-6" ng-repeat="node in cluster" ng-if="cluster.length && cluster.length <= 4">
    <div class="well well-sm">
      <h4>
        <i class="fa fa-fw {{getNodeIcon(node)}}"></i>
        <span ng-bind="node.ip + ':' + node.port"></span>
        <span ng-bind="' (' + node.worker_id + ')'" ng-if="node.process_type === 'Worker'"></span>
      </h4>
      <h5>^loc_MEMORY_USED^:</h5>
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="{{node.mem_usage.heapUsed}}" aria-valuemin="0" aria-valuemax="{{node.mem_usage.heapTotal}}" style="width: {{getNodeMemoryPercentage(node)}}" ng-bind="getNodeMemoryPercentage(node)"></div>
      </div>
      <span class="has-tooltip" style="margin-right: 5px" title="^loc_UPTIME^">
        <i class="fa fa-fw fa-clock-o"></i>
        <span ng-bind="getFormattedUptime(node.uptime)"></span>
      </span>
      <span class="has-tooltip" style="margin-right: 5px" title="^loc_REQUESTS_TOTAL^">
        <i class="fa fa-fw fa-download has-tooltip"></i>
        <span ng-bind="node.requests"></span>
      </span>
      <span class="has-tooltip" style="margin-right: 5px" title="^loc_REQUESTS_CURRENT^">
        <i class="fa fa-fw fa-users has-tooltip"></i>
        <span ng-bind="node.currentRequests"></span>
      </span>
      <span class="has-tooltip" style="margin-right: 5px" title="^loc_LAST_MODIFIED^">
        <i class="fa fa-fw fa-edit has-tooltip"></i>
        <span ng-bind="node.last_modified | date:'MMM d'"></span>
      </span>
    </div>
  </div>
  <div class="col-md-12" ng-if="cluster.length && cluster.length > 4">
    <div class="well well-sm">
      <table class="table table-condensed no-margin">
        <thead>
          <tr>
            <th></th>
            <th>^loc_SERVER^</th>
            <th>^loc_MEMORY_USED^</th>
            <th>^loc_UPTIME^</th>
            <th>^loc_REQUESTS_TOTAL^</th>
            <th>^loc_REQUESTS_CURRENT^</th>
            <th>^loc_LAST_MODIFIED^</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="node in cluster">
            <td><i class="fa fa-fw {{getNodeIcon(node)}}"></i></td>
            <td>
              <span ng-bind="node.ip + ':' + node.port"></span>
              <span ng-bind="' (' + node.worker_id + ')'" ng-if="node.process_type === 'Worker'"></span>
            </td>
            <td ng-bind="getNodeMemoryPercentage(node)"></td>
            <td ng-bind="getFormattedUptime(node.uptime)"></td>
            <td ng-bind="node.requests"></td>
            <td ng-bind="node.currentRequests"></td>
            <td ng-bind="node.last_modified | date:'MMM d'"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
