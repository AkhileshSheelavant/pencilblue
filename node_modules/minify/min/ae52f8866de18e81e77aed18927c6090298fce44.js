function setupUpload(e){siteRoot=e,saveMediaURL=siteRoot+"/actions/admin/content/media/inline_add_media",$(function(){"use strict";var e=siteRoot+"/actions/admin/content/media/upload_media";$("#media_file").fileupload({url:e,dataType:"json",done:function(e,i){$("#upload_progress").hide(),validateMediaURL(i.result.filename,!0)},progressall:function(e,i){$("#upload_progress").show();var a=parseInt(i.loaded/i.total*100,10);$("#upload_progress .progress-bar").css("width",a+"%")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled")})}function showMediaModal(e){$("#media_display").html(""),$("#link_to_media").hide(),$("#upload_media").hide(),$(e).show(),$("#media_modal").modal({backdrop:"static",keyboard:!0})}function validateMediaURL(e,i){if(0!=e.length){var a=e.substr(e.lastIndexOf(".")+1);switch(a){case"jpg":case"jpeg":case"png":case"gif":case"svg":return setMediaValues(i,"image",e),previewImage(e),void 0;case"mp4":return setMediaValues(i,"video/mp4",e),previewHTML5Video(e,"video/mp4"),void 0;case"webm":return setMediaValues(i,"video/webm",e),previewHTML5Video(e,"video/webm"),void 0;case"ogv":return setMediaValues(i,"video/ogg",e),previewHTML5Video(e,"video/ogg"),void 0}if(-1!=e.indexOf("youtube.com")){if(-1!=e.indexOf("v=")){var d=e.substr(e.indexOf("v=")+2);-1!=d.indexOf("&")&&(d=d.substr(0,d.indexOf("&"))),setMediaValues(i,"youtube",d),previewYouTube(d)}}else if(-1!=e.indexOf("youtu.be")){if(-1!=e.indexOf("/")){var d=e.substr(e.lastIndexOf("/")+1);-1!=d.indexOf("&")&&(d=d.substr(0,d.indexOf("&"))),setMediaValues(i,"youtube",d),previewYouTube(d)}}else if(-1!=e.indexOf("vimeo.com")){if(-1!=e.indexOf("/")){var d=e.substr(e.lastIndexOf("/")+1);-1!=d.indexOf("&")&&(d=d.substr(0,d.indexOf("&"))),setMediaValues(i,"vimeo",d),previewVimeo(d)}}else if(-1!=e.indexOf("dailymotion.com/video/")){var d=e.substr(e.lastIndexOf("/")+1);-1!=d.indexOf("&")&&(d=d.substr(0,d.indexOf("&"))),setMediaValues(i,"daily_motion",d),previewDailyMotion(d)}else if(-1!=e.indexOf("dai.ly")&&-1!=e.indexOf("/")){var d=e.substr(e.lastIndexOf("/")+1);-1!=d.indexOf("&")&&(d=d.substr(0,d.indexOf("&"))),setMediaValues(i,"daily_motion",d),previewDailyMotion(d)}}}function setMediaValues(e,i,a){$("#is_file").prop("checked",e),$("#media_type").val(i),$("#location").val(a),$("#link_loading").show(),getMediaThumb(i,a,function(e){$("#link_loading").hide(),$("#thumb").val(e),$("#save_button").removeAttr("disabled")})}function getMediaThumb(e,i,a){switch(e){case"image":case"video/mp4":case"video/webm":case"video/ogg":a(i);break;case"youtube":a("http://img.youtube.com/vi/"+i+"/0.jpg");break;case"vimeo":$.getJSON("http://vimeo.com/api/v2/video/"+i+".json",function(e){a(e[0].thumbnail_medium)});break;case"daily_motion":a("http://www.dailymotion.com/thumbnail/video/"+i);break;default:return""}}function previewImage(e){$("#media_display").html('<img src="'+e+'" style="max-height: 200px;"></img>')}function previewHTML5Video(e,i){$("#media_display").html('<video style="max-height: 300px;" controls><source src="'+e+'" type="'+i+'"></video>')}function previewYouTube(e){$("#media_display").html('<iframe width="420" height="315" src="//www.youtube.com/embed/'+e+'" frameborder="0" allowfullscreen></iframe>')}function previewVimeo(e){$("#media_display").html('<iframe src="//player.vimeo.com/video/'+e+'" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')}function previewDailyMotion(e){$("#media_display").html('<iframe frameborder="0" width="480" height="270" src="http://www.dailymotion.com/embed/video/'+e+'"></iframe>')}function checkForAddMediaSave(){buildTopics(function(e){$("#media_topics").val(e),$.post(saveMediaURL,$(".modal-body fieldset").serialize(),function(e){var i=JSON.parse(e),a=mediaItemTemplate.split("^media_id^").join(i._id.toString());a=a.split("^media_name^").join(i.name),a=a.split("^media_icon^").join(getMediaIcon(i.media_type)),a=a.split("^media_caption^").join(i.caption),a=a.split("^media_link^").join(getMediaLink(i.media_type,i.location,i.is_file)),$("#active_media").append(a),$("#media .col-md-3").draggable({revert:"invalid",containment:"document",helper:"clone",cursor:"move"}),$("#media_modal").modal("hide")})})}function getMediaIcon(e){var i="";switch(e){case"image":i="picture-o";break;case"video/mp4":case"video/webm":case"video/ogg":i="film";break;case"youtube":i="youtube";break;case"vimeo":i="vimeo-square";break;case"daily_motion":i="play-circle-o";break;default:i="question"}return'<i class="fa fa-'+i+'"></i>'}function getMediaLink(e,i,a){switch(e){case"youtube":return"http://youtube.com/watch/?v="+i;case"vimeo":return"http://vimeo.com/"+i;case"daily_motion":return"http://dailymotion.com/video/"+i;case"image":case"video/mp4":case"video/webm":case"video/ogg":default:return a?siteRoot+i:i}}var siteRoot,saveMediaURL,mediaItemTemplate='<div id="media_^media_id^" class="col-md-3 media_item"><div class="panel panel-info"><div class="panel-heading"><div style="font-size: 1.5em"><i class="fa fa-bars"></i>&nbsp;^media_icon^&nbsp;<a href="javascript:window.open(\'^media_link^\', \'_blank\')"><i class="fa fa-eye" style="float: right; margin-right: .5em;"></i></a></div> <div class="media_name">^media_name^</div></div><div class="panel-footer"><span class="media_caption">^media_caption^</span></div></div></div>';$(document).ready(function(){$("#media .col-md-3").draggable({revert:"invalid",containment:"document",helper:"clone",cursor:"move"}),$("#active_media").droppable({accept:"#media .col-md-3",drop:function(e,i){$("#active_media").append(i.draggable)}}),$("#inactive_media").droppable({accept:"#media .col-md-3",drop:function(e,i){$("#inactive_media").append(i.draggable)}}),new jNarrow("#media_search","#inactive_media .media_item",{searchChildElement:".media_name",searchButton:"#media_search_button",searchText:'<i class="fa fa-search"></i>',clearText:'<i class="fa fa-times"></i>'})});